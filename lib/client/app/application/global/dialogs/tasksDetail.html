<style>
    md-list-item md-input-container {width: 100%;}
    .md-default-theme .md-calendar-date.md-calendar-selected-date .md-calendar-date-selection-indicator, .md-calendar-date.md-calendar-selected-date .md-calendar-date-selection-indicator, .md-default-theme .md-calendar-date.md-focus.md-calendar-selected-date .md-calendar-date-selection-indicator, .md-calendar-date.md-focus.md-calendar-selected-date .md-calendar-date-selection-indicator {background: {{primary_hue_normal.value}}!important;}
    .md-default-theme .md-datepicker-open .md-datepicker-calendar-icon, .md-datepicker-open .md-datepicker-calendar-icon {color: {{primary_hue_normal.value}}!important;}
    .md-default-theme .md-calendar-date.md-calendar-date-today .md-calendar-date-selection-indicator, .md-calendar-date.md-calendar-date-today .md-calendar-date-selection-indicator {border: 1px solid {{primary_hue_normal.value}};}
    md-select.md-default-theme:not([disabled]):focus .md-select-value, md-select:not([disabled]):focus .md-select-value {border-bottom-color: {{primary_hue_normal.value}}!important;}
</style>
<div class="secondary-dialog-curtain taskrunner" ng-show="task_runner_task_modify_visible == true" ng-controller="lightweightController">
    <md-card class="suite-dialog md-card-base card inputs">

        <md-card-title style="position: relative;" layout="column" layout-align="start center" layout-gt-sm="row" layout-align-gt-sm="center center">


            <!-- Action Buttons -->
            <md-button class="md-fab md-mini" aria-label="Switch between grid and list view" style="position: absolute; bottom: -26px; left: 16px; background-color: {{base_hue_lightest.value}}!important;" ng-confirm-message="Are you sure you want to delete this task?" ng-confirm-click="deleteTask(taskUpdateObj); closeUpdateTask(); clearForm(taskUpdateForm)" ng-confirm-condition="true">
                <md-icon style="color: {{primary_hue_normal.value}}; cursor: pointer;" aria-label="Remove Task" md-font-library="material-icons">delete</md-icon>
            </md-button>
            <!-- Action Buttons -->


            <md-card-title-text>
                <span class="md-headline">{{taskUpdateObj.name}}</span>
            </md-card-title-text>

            <span flex></span>

            <md-icon style="color: {{base_hue_darkest.value}}; cursor: pointer;" aria-label="Remove Task" md-font-library="material-icons" ng-confirm-message="Are you sure you want to cancel adding a new task?" ng-confirm-click="closeUpdateTask(); clearTaskModel(taskUpdateForm)" ng-confirm-condition="true">close</md-icon>
            
        </md-card-title>

        <md-card-content flex>
            <md-content class="md-padding" flex>
                <div layout="column" layout-align="center center" layout-margin flex>
                    <div style="width: 100%" layout="row" layout-align="center start" flex>
                        <md-card class="md-whiteframe-4dp" style="background: #fafafa;" flex flex-gt-sm="40">
                            <form name="taskUpdateForm">
                                <md-card-content>

                                    <md-card-header>
                                        <md-card-header-text>
                                            <span class="md-title">Task Content</span>
                                            <span class="md-subhead" ng-show="taskUpdateObj.isGeneratedByUser == true">This Task Is Triggered By User Activity</span>
                                            <span class="md-subhead" ng-show="taskUpdateObj.isManuallyTriggered == true">This Task Is Triggered By Admin Users</span>
                                            <span class="md-subhead" ng-show="taskUpdateObj.isReoccurring == true">This Task Repeats On A Regular Interval</span>
                                        </md-card-header-text>
                                    </md-card-header> 

                                    <md-list-item>
                                        <md-input-container class="md-block lightweight-md-input" flex>
                                            <label>Task Name</label>
                                            <input name="name" ng-model="taskUpdateObj.name" minlength="3" required>
                                            <div ng-messages="taskUpdateForm.name.$error" ng-show="taskUpdateForm.name.$dirty">
                                                <div ng-message="required">Task name required!</div>
                                                <div ng-message="minlength">Task name too short!</div>
                                            </div>
                                        </md-input-container>
                                    </md-list-item>
                                    <md-list-item>
                                        <md-input-container class="md-block lightweight-md-input" flex>
                                            <label>Task Title</label>
                                            <input name="title" ng-model="taskUpdateObj.title" minlength="3" required>
                                            <div ng-messages="taskUpdateForm.title.$error" ng-show="taskUpdateForm.title.$dirty">
                                                <div ng-message="required">Task title required!</div>
                                                <div ng-message="minlength">Task title too short!</div>
                                            </div>
                                        </md-input-container>
                                    </md-list-item>
                                    <md-list-item>
                                        <md-input-container class="md-block lightweight-md-input" flex>
                                            <label>Task Body</label>
                                            <textarea name="body" md-detect-hidden="true" ng-model="taskUpdateObj.body" rows="3" minlength="10" md-maxlength="250" required></textarea>
                                            <div ng-messages="taskUpdateForm.body.$error" ng-show="taskUpdateForm.body.$dirty">
                                                <div ng-message="required">Task body required!</div>
                                                <div ng-message="minlength">Task body too short!</div>
                                                <div ng-message="md-maxlength">Task body too long!</div>
                                            </div>
                                        </md-input-container>
                                    </md-list-item>
                                    <md-list-item>
                                        <md-input-container class="md-block lightweight-md-input" flex>
                                            <label>Task Link</label>
                                            <md-select name="item_url" ng-model="taskUpdateObj.link">
                                                <md-option><em>None</em></md-option>
                                                <md-option ng-value="url.url" ng-repeat="url in app_pages track by $index">
                                                    {{url.url}}
                                                </md-option>
                                            </md-select>
                                        </md-input-container>
                                    </md-list-item>

                                    <md-divider></md-divider>

                                    <md-card-header ng-show="taskUpdateObj.isGeneratedByUser">
                                        <md-card-header-text>
                                            <span class="md-title">Task Trigger</span>
                                            <span class="md-subhead">Control Task Automation</span>
                                        </md-card-header-text>
                                    </md-card-header> 

                                    <md-list-item ng-show="taskUpdateObj.isGeneratedByUser">
                                        <md-input-container class="md-block lightweight-md-input" flex>
                                            <label>App Activity Trigger</label>
                                            <md-select name="activity_trigger" ng-model="taskUpdateObj.activity_trigger" ng-required="taskUpdateObj.isGeneratedByUser">
                                                <md-option><em>None</em></md-option>
                                                <md-option ng-repeat="trigger in app_triggers" ng-value="trigger">
                                                    {{trigger}}
                                                </md-option>
                                            </md-select>
                                            <div ng-messages="taskUpdateForm.activity_trigger.$error" ng-show="taskUpdateForm.activity_trigger.$dirty">
                                                <div ng-message="required">App interaction trigger required!</div>
                                            </div>
                                        </md-input-container>
                                    </md-list-item>

                                    <md-divider></md-divider>

                                    <md-card-header>
                                        <md-card-header-text>
                                            <span class="md-title">Task Targeting</span>
                                            <span class="md-subhead">Control Delivery Of Task Content</span>
                                        </md-card-header-text>
                                    </md-card-header>

                                    <md-list-item ng-show="taskUpdateObj.channels != 'In App Dialog' && !taskUpdateObj.isGeneratedByUser">
                                        <md-input-container class="md-block lightweight-md-input">
                                            <label>User Types To Send Notifications To</label>
                                            <md-select name="send_to" ng-model="taskUpdateObj.send_to_roles" multiple flex ng-required="taskUpdateObj.channels != 'In App Dialog' && !taskUpdateObj.isGeneratedByUser">
                                                <md-option><em>None</em></md-option>
                                                <md-option ng-repeat="role in rolelist" ng-value="role.role">
                                                    {{role.role}}
                                                </md-option>
                                            </md-select>
                                            <div ng-messages="taskUpdateForm.send_to.$error" ng-show="taskUpdateForm.send_to.$dirty">
                                                <div ng-message="required">Recipient type required!</div>
                                            </div>
                                        </md-input-container>
                                    </md-list-item>
                                    <md-list-item ng-show="taskUpdateObj.channels != 'In App Dialog'">
                                        <md-input-container class="md-block lightweight-md-input" flex>
                                            <label>User Types To Send Task Alerts</label>
                                            <md-select name="alert_users" ng-model="taskUpdateObj.alert_roles" multiple ng-required="taskUpdateObj.channels != 'In App Dialog'">
                                                <md-option><em>None</em></md-option>
                                                <md-option ng-repeat="role in rolelist" ng-value="role.role">
                                                    {{role.role}}
                                                </md-option>
                                            </md-select>
                                            <div ng-messages="taskUpdateForm.alert_users.$error" ng-show="taskUpdateForm.alert_users.$dirty">
                                                <div ng-message="required">Alert receiver type required!</div>
                                            </div>
                                        </md-input-container>
                                    </md-list-item> 

                                    <md-divider></md-divider>

                                    <md-card-header>
                                        <md-card-header-text>
                                            <span class="md-title">Task Scheduling</span>
                                            <span class="md-subhead">Determine When To Run This Task</span>
                                        </md-card-header-text>
                                    </md-card-header>

                                    <md-list-item ng-show="!taskUpdateObj.isReoccuring && !taskUpdateObj.isGeneratedByUser">
                                        <md-input-container class="md-block lightweight-md-input" flex>
                                            <label>Specify A Run Date For The Task</label>
                                            <md-datepicker flex style="width: 100%;" ng-required="!taskUpdateObj.isReoccuring && !taskUpdateObj.isGeneratedByUser" ng-model="taskUpdateObj.runDate" md-placeholder="No Date Chosen"></md-datepicker>
                                        </md-input-container>
                                    </md-list-item>                                     
                                    <md-list-item ng-show="taskUpdateObj.isReoccuring">
                                        <md-input-container class="md-block lightweight-md-input" flex>
                                            <label>How Often Does This Task Run?</label>
                                            <md-select ng-model="taskUpdateObj.frequency" ng-required="taskUpdateObj.isReoccuring">
                                                <md-option><em>None</em></md-option>
                                                <md-option ng-value="'onCreate'">
                                                    Once Created
                                                </md-option>
                                                <md-option ng-value="'daily'">
                                                    Daily
                                                </md-option>
                                                <md-option ng-value="'weekly'">
                                                    Weekly
                                                </md-option>
                                                <md-option ng-value="'bi-weekly'">
                                                    Bi-Weekly
                                                </md-option>
                                                <md-option ng-value="'monthly'">
                                                    Monthly
                                                </md-option>
                                            </md-select>
                                        </md-input-container>
                                    </md-list-item>
                                    <md-list-item ng-show="taskUpdateObj.isReoccuring != 'monthly' && !taskUpdateObj.isGeneratedByUser && !taskUpdateObj.isManuallyTriggered">
                                        <md-input-container class="md-block lightweight-md-input" flex>
                                            <label>Choose Which Day To Run The Task</label>
                                            <md-select ng-model="taskUpdateObj.runDay" ng-required="taskUpdateObj.isReoccuring">
                                                <md-option><em>None</em></md-option>
                                                <md-option ng-value="0">
                                                    Sunday
                                                </md-option>
                                                <md-option ng-value="1">
                                                    Monday
                                                </md-option>
                                                <md-option ng-value="2">
                                                    Tuesday
                                                </md-option>
                                                <md-option ng-value="3">
                                                    Wednesday
                                                </md-option>
                                                <md-option ng-value="4">
                                                    Thursday
                                                </md-option>
                                                <md-option ng-value="5">
                                                    Friday
                                                </md-option>
                                                <md-option ng-value="6">
                                                    Saturday
                                                </md-option>
                                            </md-select>
                                        </md-input-container>
                                    </md-list-item>
                                    <md-list-item>
                                        <md-input-container class="md-block lightweight-md-input" flex="100" flex-sm="100" flex-gt-sm="100">
                                            <label>Hour</label>
                                            <md-select ng-model="taskUpdateObj.runTime" ng-required="true">
                                                <md-option ng-repeat="time in timesSans" ng-value="time">
                                                    {{time}}
                                                </md-option>
                                            </md-select>
                                        </md-input-container>
                                    </md-list-item>                              
                                </md-card-content>
                                <md-card-actions layout="row" layout-align="end center" flex>
                                    <md-button ng-click="closeUpdateTask(); clearForm(taskUpdateForm)">Cancel</md-button>
                                    <md-button class="md-raised" ng-confirm-message="Are you sure you want to update this task?" ng-confirm-click="updateTask(taskUpdateObj)" ng-confirm-condition="true" style="background-color: {{primary_hue_normal.value}}; color: {{base_hue_lightest.value}};">Save</md-button>
                                </md-card-actions>
                            </form>
                        </md-card>
                        <md-card ng-show="taskUpdateObj.channels == 'In App Dialog'" class="md-card-base md-whiteframe-4dp" style="background-color: {{base_hue_lightest.value}}; position: relative;" flex flex-gt-sm="40">
                            <md-button ng-click="mediavault_filepicker(task)" class="md-fab md-mini" aria-label="Edit Element Image" style="position: absolute; top: 16px; right: 16px; background-color: {{primary_hue_normal.value}}!important;">
                                <md-icon style="color: {{base_hue_lightest.value}}; cursor: pointer;" aria-label="change photo" md-font-library="material-icons">insert_photo</md-icon>
                            </md-button>
                            <img ng-value="'{{taskUpdateObj.source}}'" ng-src="{{ taskUpdateObj.source || 'https://storage.googleapis.com/mma-texas.appspot.com/media/images/missing-image-wide.png'}}" class="md-card-image">
                        </md-card>
                    </div>
                </div>
            </md-content>
        </md-card-content>
        <md-card-actions layout="row" layout-align="end center" class="footer-backend">
            <md-button disabled>Superpowered by Lightweight</md-button>
            <div flex></div>
            <md-button class="md-raised" ng-click="closeUpdateTask(); clearTaskModel(taskUpdateForm)" style="background-color: {{primary_hue_normal.value}}; color: {{base_hue_lightest.value}};">Close</md-button>
        </md-card-actions>
    </md-card>
</div>