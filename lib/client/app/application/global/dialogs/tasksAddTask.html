<style>
    md-list-item md-input-container {width: 100%;}
    .md-default-theme .md-calendar-date.md-calendar-selected-date .md-calendar-date-selection-indicator, .md-calendar-date.md-calendar-selected-date .md-calendar-date-selection-indicator, .md-default-theme .md-calendar-date.md-focus.md-calendar-selected-date .md-calendar-date-selection-indicator, .md-calendar-date.md-focus.md-calendar-selected-date .md-calendar-date-selection-indicator {background: {{primary_hue_normal.value}}!important;}
    .md-default-theme .md-datepicker-open .md-datepicker-calendar-icon, .md-datepicker-open .md-datepicker-calendar-icon {color: {{primary_hue_normal.value}}!important;}
    .md-default-theme .md-calendar-date.md-calendar-date-today .md-calendar-date-selection-indicator, .md-calendar-date.md-calendar-date-today .md-calendar-date-selection-indicator {border: 1px solid {{primary_hue_normal.value}};}
    md-select.md-default-theme:not([disabled]):focus .md-select-value, md-select:not([disabled]):focus .md-select-value {border-bottom-color: {{primary_hue_normal.value}}!important;}
</style>
<div class="secondary-dialog-curtain taskrunner" ng-show="task_runner_task_add_visible == true" ng-controller="lightweightController">
    <md-card class="suite-dialog md-card-base card inputs">

        <md-card-title style="position: relative;" layout="column" layout-align="start center" layout-gt-sm="row" layout-align-gt-sm="center center">

            <md-card-title-text>
                <span class="md-headline">{{task.name || 'Create A New Task'}}</span>
            </md-card-title-text>
            
        </md-card-title>

        <md-card-content flex>
            <md-content class="md-padding" flex>
                <div layout="column" layout-align="center center" layout-margin flex>
                    <div style="width: 100%" layout="row" layout-align="center start" flex>
                        <md-card class="md-whiteframe-4dp" style="background: #fafafa;" flex flex-gt-sm="40">
                            <form name="createTaskForm">
                                <md-card-content>
                                    <md-list-item>
                                        <md-input-container class="md-block lightweight-md-input" flex>
                                            <label>Task Name</label>
                                            <input name="name" ng-model="task.name" minlength="3" required>
                                            <div ng-messages="createTaskForm.name.$error" ng-show="createTaskForm.name.$dirty">
                                                <div ng-message="required">Task name required!</div>
                                                <div ng-message="minlength">Task name too short!</div>
                                            </div>
                                        </md-input-container>
                                    </md-list-item>
                                    <md-list-item>
                                        <md-input-container class="md-block lightweight-md-input" flex>
                                            <label>Task Title</label>
                                            <input name="title" ng-model="task.title" minlength="3" required>
                                            <div ng-messages="createTaskForm.title.$error" ng-show="createTaskForm.title.$dirty">
                                                <div ng-message="required">Task title required!</div>
                                                <div ng-message="minlength">Task title too short!</div>
                                            </div>
                                        </md-input-container>
                                    </md-list-item>
                                    <md-list-item>
                                        <md-input-container class="md-block lightweight-md-input" flex>
                                            <label>Task Body</label>
                                            <textarea name="body" md-detect-hidden="true" ng-model="task.body" rows="3" minlength="10" md-maxlength="250" required></textarea>
                                            <div ng-messages="createTaskForm.body.$error" ng-show="createTaskForm.body.$dirty">
                                                <div ng-message="required">Task body required!</div>
                                                <div ng-message="minlength">Task body too short!</div>
                                                <div ng-message="md-maxlength">Task body too long!</div>
                                            </div>
                                        </md-input-container>
                                    </md-list-item>
                                    <span ng-show="createTaskForm.title.$dirty">
                                        <md-list-item>
                                            <md-input-container class="md-block lightweight-md-input" flex>
                                                <label>Task Link</label>
                                                <md-select name="item_url" ng-model="task.link">
                                                    <md-option><em>None</em></md-option>
                                                    <md-option ng-value="url.url" ng-repeat="url in app_pages track by $index">
                                                        {{url.url}}
                                                    </md-option>
                                                </md-select>
                                            </md-input-container>
                                        </md-list-item>
                                        <md-list-item>
                                            <label style="color: rgba(0,0,0,0.38);">Is This Task User Generated</label>
                                            <md-checkbox class="md-secondary" aria-label="Is this task user generated checkbox" ng-model="task.isGeneratedByUser" ng-init="false">
                                            </md-checkbox>
                                        </md-list-item>
                                        <md-list-item ng-show="task.isGeneratedByUser">
                                            <md-input-container class="md-block lightweight-md-input" flex>
                                                <label>App Activity Trigger</label>
                                                <md-select name="activity_trigger" ng-model="task.activity_trigger" ng-required="task.isGeneratedByUser">
                                                    <md-option><em>None</em></md-option>
                                                    <md-option ng-repeat="trigger in app_triggers" ng-value="trigger">
                                                        {{trigger}}
                                                    </md-option>
                                                </md-select>
                                                <div ng-messages="createTaskForm.activity_trigger.$error" ng-show="createTaskForm.activity_trigger.$dirty">
                                                    <div ng-message="required">App interaction trigger required!</div>
                                                </div>
                                            </md-input-container>
                                        </md-list-item>
                                        <md-list-item>
                                            <md-input-container class="md-block lightweight-md-input" flex>
                                                <label>Choose Channels</label>
                                                <md-select ng-model="task.channels" multiple required>
                                                    <md-option><em>None</em></md-option>
                                                    <md-option ng-value="'Email'">
                                                        Email
                                                    </md-option>
                                                    <md-option ng-value="'Notification'">
                                                        Notification
                                                    </md-option>
                                                    <md-option ng-value="'In App Dialog'">
                                                        In App Dialog
                                                    </md-option>
                                                </md-select>
                                            </md-input-container>
                                        </md-list-item> 
                                        <span ng-show="task.channels != 'In App Dialog'">
                                            <md-list-item ng-show="!task.isGeneratedByUser">
                                                <md-input-container class="md-block lightweight-md-input">
                                                    <label>User Types To Send Notifications To</label>
                                                    <md-select name="send_to" ng-model="task.send_to_roles" multiple flex ng-required="task.channels != 'In App Dialog' && !task.isGeneratedByUser">
                                                        <md-option><em>None</em></md-option>
                                                        <md-option ng-repeat="role in rolelist" ng-value="role.role">
                                                            {{role.role}}
                                                        </md-option>
                                                    </md-select>
                                                    <div ng-messages="createTaskForm.send_to.$error" ng-show="createTaskForm.send_to.$dirty">
                                                        <div ng-message="required">Recipient type required!</div>
                                                    </div>
                                                </md-input-container>
                                            </md-list-item>
                                            <md-list-item>
                                                <md-input-container class="md-block lightweight-md-input" flex>
                                                    <label>User Types To Send Task Alerts</label>
                                                    <md-select name="alert_users" ng-model="task.alert_roles" multiple ng-required="task.channels != 'In App Dialog'">
                                                        <md-option><em>None</em></md-option>
                                                        <md-option ng-repeat="role in rolelist" ng-value="role.role">
                                                            {{role.role}}
                                                        </md-option>
                                                    </md-select>
                                                    <div ng-messages="createTaskForm.alert_users.$error" ng-show="createTaskForm.alert_users.$dirty">
                                                        <div ng-message="required">Alert receiver type required!</div>
                                                    </div>
                                                </md-input-container>
                                            </md-list-item>                                   
                                            <md-list-item ng-show="!task.isGeneratedByUser">
                                                <md-input-container class="md-block lightweight-md-input" flex>
                                                    <label>Is This Reoccuring Task?</label>
                                                    <md-select ng-model="task.isReoccuring" ng-required="task.channels != 'In App Dialog' && !task.isGeneratedByUser">
                                                        <md-option><em>None</em></md-option>
                                                        <md-option ng-value="true">
                                                            Yes
                                                        </md-option>
                                                        <md-option ng-value="false">
                                                            No
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </md-list-item>
                                            <md-list-item ng-show="!task.isReoccuring && !task.isGeneratedByUser">
                                                <md-input-container class="md-block lightweight-md-input" flex ng-required="task.channels != 'In App Dialog' && !task.isReoccuring">
                                                    <label>Specify A Run Date For The Task</label>
                                                    <md-datepicker flex style="width: 100%;" ng-model="task.runDate" md-placeholder="No Date Chosen"></md-datepicker>
                                                </md-input-container>
                                            </md-list-item>                                      
                                            <md-list-item ng-show="task.isReoccuring && !task.isGeneratedByUser">
                                                <md-input-container class="md-block lightweight-md-input" flex>
                                                    <label>How Often Does This Task Run?</label>
                                                    <md-select ng-model="task.frequency" ng-required="task.isReoccuring">
                                                        <md-option><em>None</em></md-option>
                                                        <md-option ng-value="'onCreate'">
                                                            Once Created
                                                        </md-option>
                                                        <md-option ng-value="'Daily'">
                                                            Daily
                                                        </md-option>
                                                        <md-option ng-value="'Weekly'">
                                                            Weekly
                                                        </md-option>
                                                        <md-option ng-value="'Bi-weekly'">
                                                            Bi-Weekly
                                                        </md-option>
                                                        <md-option ng-value="'Monthly'">
                                                            Monthly
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </md-list-item>
                                            <md-list-item ng-show="task.isReoccuring && !task.isGeneratedByUser">
                                                <md-input-container class="md-block lightweight-md-input" flex>
                                                    <label>Choose Which Day To Run The Task</label>
                                                    <md-select ng-model="task.runDay" ng-required="task.isReoccuring">
                                                        <md-option><em>None</em></md-option>
                                                        <md-option ng-value="'Sunday'">
                                                            Sunday
                                                        </md-option>
                                                        <md-option ng-value="'Monday'">
                                                            Monday
                                                        </md-option>
                                                        <md-option ng-value="'Tuesday'">
                                                            Tuesday
                                                        </md-option>
                                                        <md-option ng-value="'Wednesday'">
                                                            Wednesday
                                                        </md-option>
                                                        <md-option ng-value="'Thursday'">
                                                            Thursday
                                                        </md-option>
                                                        <md-option ng-value="'Friday'">
                                                            Friday
                                                        </md-option>
                                                        <md-option ng-value="'Saturday'">
                                                            Saturday
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </md-list-item>
                                            <md-list-item ng-show="!task.isGeneratedByUser">
                                                <md-input-container class="md-block lightweight-md-input" flex="100" flex-sm="100" flex-gt-sm="50">
                                                    <label>Hour</label>
                                                    <md-select ng-model="task.runTimeHour" ng-required="task.isReoccuring">
                                                        <md-option ng-repeat="time in times" ng-value="time">
                                                            {{time}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                                <md-input-container class="md-block lightweight-md-input" flex="100" flex-sm="100" flex-gt-sm="50">
                                                    <label>Meridiem</label>
                                                    <md-select ng-model="task.runTimeMeridiem" ng-required="task.isReoccuring">
                                                        <md-option><em>None</em></md-option>
                                                        <md-option ng-repeat="meridiem in meridiems" ng-value="meridiem">
                                                            {{meridiem}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </md-list-item>
                                        </span>
                                    </span>                                 
                                </md-card-content>
                                <md-card-actions layout="row" layout-align="end center" flex>
                                    <md-button ng-click="closeCreateTask(); clearTaskModel(createTaskForm)">Cancel</md-button>
                                    <md-button class="md-raised" ng-click="null" style="background-color: {{primary_hue_normal.value}}; color: {{base_hue_lightest.value}};">Update</md-button>
                                </md-card-actions>
                            </form>
                        </md-card>
                        <md-card ng-show="task.channels == 'In App Dialog'" class="md-card-base md-whiteframe-4dp" style="background-color: {{base_hue_lightest.value}}; position: relative;" flex flex-gt-sm="40">
                            <md-button ng-click="mediavault_filepicker(task)" class="md-fab md-mini" aria-label="Edit Element Image" style="position: absolute; top: 16px; right: 16px; background-color: {{primary_hue_normal.value}}!important;">
                                <md-icon style="color: {{base_hue_lightest.value}}; cursor: pointer;" aria-label="change photo" md-font-library="material-icons">insert_photo</md-icon>
                            </md-button>
                            <img ng-value="'{{task.source}}'" ng-src="{{ task.source || 'https://storage.googleapis.com/mma-texas.appspot.com/media/images/missing-image-wide.png'}}" class="md-card-image">
                        </md-card>
                    </div>
                </div>
            </md-content>
        </md-card-content>
        <md-card-actions layout="row" layout-align="end center">
            <md-button disabled>Superpowered by Lightweight</md-button>
            <div flex></div>
            <md-button class="md-raised" ng-click="closeCreateTask(); clearTaskModel(createTaskForm)" style="background-color: {{primary_hue_normal.value}}; color: {{base_hue_lightest.value}};">Close</md-button>
        </md-card-actions>
    </md-card>
</div>