<style>
    md-list-item md-input-container {width: 100%;}
    .md-default-theme .md-calendar-date.md-calendar-selected-date .md-calendar-date-selection-indicator, .md-calendar-date.md-calendar-selected-date .md-calendar-date-selection-indicator, .md-default-theme .md-calendar-date.md-focus.md-calendar-selected-date .md-calendar-date-selection-indicator, .md-calendar-date.md-focus.md-calendar-selected-date .md-calendar-date-selection-indicator {background: {{primary_hue_normal.value}}!important;}
    .md-default-theme .md-datepicker-open .md-datepicker-calendar-icon, .md-datepicker-open .md-datepicker-calendar-icon {color: {{primary_hue_normal.value}}!important;}
    .md-default-theme .md-calendar-date.md-calendar-date-today .md-calendar-date-selection-indicator, .md-calendar-date.md-calendar-date-today .md-calendar-date-selection-indicator {border: 1px solid {{primary_hue_normal.value}};}
    md-select.md-default-theme:not([disabled]):focus .md-select-value, md-select:not([disabled]):focus .md-select-value {border-bottom-color: {{primary_hue_normal.value}}!important;}
</style>
<div class="secondary-dialog-curtain taskrunner" ng-show="task_runner_task_add_visible == true" ng-controller="lightweightController">
    <md-card class="suite-dialog md-card-base card inputs">

        <md-card-title style="position: relative;" layout="column" layout-align="start center" layout-gt-sm="row" layout-align-gt-sm="center center">

            <md-card-title-text>
                <span class="md-headline">{{taskAddObj.name || 'Create A New Task'}}</span>
            </md-card-title-text>
            
        </md-card-title>

        <md-card-content flex>
            <md-content class="md-padding" flex>
                <div layout="column" layout-align="center center" layout-margin flex>
                    <div style="width: 100%" layout="row" layout-align="center start" flex>
                        <md-card class="md-whiteframe-4dp" style="background: #fafafa;" flex flex-gt-sm="40">
                            <form name="createTaskForm">
                                <md-card-content>

                                    <md-card-header>
                                        <md-card-header-text>
                                            <span class="md-title">Task Content</span>
                                            <span class="md-subhead">Information Users Will See</span>
                                        </md-card-header-text>
                                    </md-card-header>

                                    <md-list-item>
                                        <md-input-container class="md-block lightweight-md-input" flex>
                                            <label>Task Name</label>
                                            <input name="name" ng-model="taskAddObj.name" minlength="3" required>
                                            <div ng-messages="createTaskForm.name.$error" ng-show="createTaskForm.name.$dirty">
                                                <div ng-message="required">Task name required!</div>
                                                <div ng-message="minlength">Task name too short!</div>
                                            </div>
                                        </md-input-container>
                                    </md-list-item>
                                    
                                    <md-list-item>
                                        <md-input-container class="md-block lightweight-md-input" flex>
                                            <label>Task Title</label>
                                            <input name="title" ng-model="taskAddObj.title" minlength="3" required>
                                            <div ng-messages="createTaskForm.title.$error" ng-show="createTaskForm.title.$dirty">
                                                <div ng-message="required">Task title required!</div>
                                                <div ng-message="minlength">Task title too short!</div>
                                            </div>
                                        </md-input-container>
                                    </md-list-item>
                                    
                                    <md-list-item>
                                        <md-input-container class="md-block lightweight-md-input" flex>
                                            <label>Task Body</label>
                                            <textarea name="body" md-detect-hidden="true" ng-model="taskAddObj.body" rows="3" minlength="10" md-maxlength="250" required></textarea>
                                            <div ng-messages="createTaskForm.body.$error" ng-show="createTaskForm.body.$dirty">
                                                <div ng-message="required">Task body required!</div>
                                                <div ng-message="minlength">Task body too short!</div>
                                                <div ng-message="md-maxlength">Task body too long!</div>
                                            </div>
                                        </md-input-container>
                                    </md-list-item>
                                    
                                    <md-list-item>
                                        <md-input-container class="md-block lightweight-md-input" flex>
                                            <label>Task Link</label>
                                            <md-select name="item_url" ng-model="taskAddObj.link">
                                                <md-option><em>None</em></md-option>
                                                <md-option ng-value="url.url" ng-repeat="url in app_pages track by $index">
                                                    {{url.url}}
                                                </md-option>
                                            </md-select>
                                        </md-input-container>
                                    </md-list-item>

                                    <span ng-show="createTaskForm.title.$dirty">

                                        <md-divider></md-divider>

                                        <md-card-header>
                                            <md-card-header-text>
                                                <span class="md-title">Task Trigger</span>
                                                <span class="md-subhead">Control Task Automation</span>
                                            </md-card-header-text>
                                        </md-card-header> 

                                        <md-list-item ng-show="!taskAddObj.isReoccuring && !taskAddObj.isManuallyTriggered">
                                            <md-input-container class="md-block lightweight-md-input" flex>
                                                <label>Is This Task Generated By Users?</label>
                                                <md-select name="userGenerated" ng-model="taskAddObj.isGeneratedByUser" ng-required="!taskAddObj.isReoccuring && !taskAddObj.isManuallyTriggered">
                                                    <md-option ng-value="false"><em>None</em></md-option>
                                                    <md-option ng-value="true">
                                                        Yes
                                                    </md-option>
                                                    <md-option ng-value="false">
                                                        No
                                                    </md-option>
                                                </md-select>
                                                <div ng-messages="createTaskForm.userGenerated.$error" ng-show="createTaskForm.userGenerated.$dirty">
                                                    <div ng-message="required">This option must be selected!</div>
                                                </div>
                                            </md-input-container>
                                        </md-list-item>

                                        <md-list-item ng-show="!taskAddObj.isReoccuring && !taskAddObj.isGeneratedByUser">
                                            <md-input-container class="md-block lightweight-md-input" flex>
                                                <label>Is This Task Manually Triggered By An Admin?</label>
                                                <md-select name="adminTrigger" ng-model="taskAddObj.isManuallyTriggered" ng-required="!taskAddObj.isGeneratedByUser && !taskAddObj.isReoccuring">
                                                    <md-option ng-value="false"><em>None</em></md-option>
                                                    <md-option ng-value="true">
                                                        Yes
                                                    </md-option>
                                                    <md-option ng-value="false">
                                                        No
                                                    </md-option>
                                                </md-select>
                                                <div ng-messages="createTaskForm.adminTrigger.$error" ng-show="createTaskForm.adminTrigger.$dirty">
                                                    <div ng-message="required">This option must be selected!</div>
                                                </div>
                                            </md-input-container>
                                        </md-list-item>

                                        <md-list-item ng-show="!taskAddObj.isGeneratedByUser && !taskAddObj.isManuallyTriggered">
                                            <md-input-container class="md-block lightweight-md-input" flex>
                                                <label>Is This Task Reoccuring?</label>
                                                <md-select name="reoccuringTrigger" ng-model="taskAddObj.isReoccuring" ng-required="taskAddObj.channels != 'In App Dialog' && !taskAddObj.isGeneratedByUser && !taskAddObj.isManuallyTriggered">
                                                    <md-option ng-value="false"><em>None</em></md-option>
                                                    <md-option ng-value="true">
                                                        Yes
                                                    </md-option>
                                                    <md-option ng-value="false">
                                                        No
                                                    </md-option>
                                                </md-select>
                                                <div ng-messages="createTaskForm.reoccuringTrigger.$error" ng-show="createTaskForm.reoccuringTrigger.$dirty">
                                                    <div ng-message="required">This option must be selected!</div>
                                                </div>
                                            </md-input-container>
                                        </md-list-item>

                                        <md-divider></md-divider>

                                        <md-card-header>
                                            <md-card-header-text>
                                                <span class="md-title">Task Targeting</span>
                                                <span class="md-subhead">Control Delivery Of Task Content</span>
                                            </md-card-header-text>
                                        </md-card-header> 

                                        <md-list-item>
                                            <md-input-container class="md-block lightweight-md-input" flex>
                                                <label>Choose Channels</label>
                                                <md-select name="channels" ng-model="taskAddObj.channels" multiple required>
                                                    <md-option><em>None</em></md-option>
                                                    <md-option ng-value="'Email'">
                                                        Email
                                                    </md-option>
                                                    <md-option ng-value="'Notification'">
                                                        Notification
                                                    </md-option>
                                                    <md-option ng-value="'In App Dialog'">
                                                        In App Dialog
                                                    </md-option>
                                                </md-select>
                                                <div ng-messages="createTaskForm.channels.$error" ng-show="createTaskForm.channels.$dirty">
                                                    <div ng-message="required">Task channel required!</div>
                                                </div>
                                            </md-input-container>
                                        </md-list-item>
                                        
                                        <md-list-item ng-show="taskAddObj.isGeneratedByUser">
                                            <md-input-container class="md-block lightweight-md-input" flex>
                                                <label>App Activity Trigger</label>
                                                <md-select name="activity_trigger" ng-model="taskAddObj.activity_trigger" ng-required="taskAddObj.isGeneratedByUser">
                                                    <md-option><em>None</em></md-option>
                                                    <md-option ng-repeat="trigger in app_triggers" ng-value="trigger">
                                                        {{trigger}}
                                                    </md-option>
                                                </md-select>
                                                <div ng-messages="createTaskForm.activity_trigger.$error" ng-show="createTaskForm.activity_trigger.$dirty">
                                                    <div ng-message="required">App interaction trigger required!</div>
                                                </div>
                                            </md-input-container>
                                        </md-list-item>
                                        
                                        <span ng-show="taskAddObj.channels != 'In App Dialog'">
                                            <md-list-item ng-show="!taskAddObj.isGeneratedByUser">
                                                <md-input-container class="md-block lightweight-md-input">
                                                    <label>User Types To Send Notifications To</label>
                                                    <md-select name="send_to" ng-model="taskAddObj.send_to_roles" multiple flex ng-required="taskAddObj.channels != 'In App Dialog' && !taskAddObj.isGeneratedByUser">
                                                        <md-option><em>None</em></md-option>
                                                        <md-option ng-repeat="role in rolelist" ng-value="role.role">
                                                            {{role.role}}
                                                        </md-option>
                                                    </md-select>
                                                    <div ng-messages="createTaskForm.send_to.$error" ng-show="createTaskForm.send_to.$dirty">
                                                        <div ng-message="required">Recipient type required!</div>
                                                    </div>
                                                </md-input-container>
                                            </md-list-item>
                                            
                                            <md-list-item>
                                                <md-input-container class="md-block lightweight-md-input" flex>
                                                    <label>User Types To Send Task Alerts</label>
                                                    <md-select name="alert_users" ng-model="taskAddObj.alert_roles" multiple ng-required="taskAddObj.channels != 'In App Dialog'">
                                                        <md-option><em>None</em></md-option>
                                                        <md-option ng-repeat="role in rolelist" ng-value="role.role">
                                                            {{role.role}}
                                                        </md-option>
                                                    </md-select>
                                                    <div ng-messages="createTaskForm.alert_users.$error" ng-show="createTaskForm.alert_users.$dirty">
                                                        <div ng-message="required">Alert receiver type required!</div>
                                                    </div>
                                                </md-input-container>
                                            </md-list-item>

                                            <md-divider></md-divider>

                                            <md-card-header>
                                                <md-card-header-text>
                                                    <span class="md-title">Task Scheduling</span>
                                                    <span class="md-subhead">Determine When To Run This Task</span>
                                                </md-card-header-text>
                                            </md-card-header>
                                                                              
                                            <md-list-item ng-show="!taskAddObj.isReoccuring && !taskAddObj.isGeneratedByUser">
                                                <md-input-container class="md-block lightweight-md-input" flex>
                                                    <label>Specify A Run Date For The Task</label>

                                                    <md-datepicker flex="80" style="width: 100%;" ng-model="taskAddObj.runDate" name="task_date" md-placeholder="No Date Chosen" md-open-on-focus></md-datepicker>
                                                    
                                                    <div ng-messages="createTaskForm.task_date.$error">
                                                        <div ng-message="required">Run date required!</div>
                                                    </div>

                                                </md-input-container>
                                            </md-list-item>
                                                                
                                            <md-list-item ng-show="taskAddObj.isReoccuring && !taskAddObj.isGeneratedByUser">
                                                <md-input-container class="md-block lightweight-md-input" flex>
                                                    <label>How Often Does This Task Run?</label>
                                                    <md-select ng-model="taskAddObj.frequency" ng-required="taskAddObj.isReoccuring">
                                                        <md-option><em>None</em></md-option>
                                                        <md-option ng-value="'onCreate'">
                                                            Once Created
                                                        </md-option>
                                                        <md-option ng-value="'daily'">
                                                            Daily
                                                        </md-option>
                                                        <md-option ng-value="'weekly'">
                                                            Weekly
                                                        </md-option>
                                                        <md-option ng-value="'bi-weekly'">
                                                            Bi-Weekly
                                                        </md-option>
                                                        <md-option ng-value="'monthly'">
                                                            Monthly
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </md-list-item>
                                            
                                            <md-list-item ng-show="taskAddObj.isReoccuring && !taskAddObj.isGeneratedByUser && !taskAddObj.isManuallyTriggered">
                                                <md-input-container class="md-block lightweight-md-input" flex>
                                                    <label>Choose Which Day To Run The Task</label>
                                                    <md-select ng-model="taskAddObj.runDay" ng-required="taskAddObj.isReoccuring">
                                                        <md-option><em>None</em></md-option>
                                                        <md-option ng-value="0">
                                                            Sunday
                                                        </md-option>
                                                        <md-option ng-value="1">
                                                            Monday
                                                        </md-option>
                                                        <md-option ng-value="2">
                                                            Tuesday
                                                        </md-option>
                                                        <md-option ng-value="3">
                                                            Wednesday
                                                        </md-option>
                                                        <md-option ng-value="4">
                                                            Thursday
                                                        </md-option>
                                                        <md-option ng-value="5">
                                                            Friday
                                                        </md-option>
                                                        <md-option ng-value="6">
                                                            Saturday
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>
                                            </md-list-item>
                                            <md-list-item>
                                                <md-input-container class="md-block lightweight-md-input" flex="100" flex-sm="100" flex-gt-sm="100">
                                                    <label>Hour</label>
                                                    <md-select ng-model="taskAddObj.runTime" ng-required="true">
                                                        <md-option ng-repeat="time in timesSans" ng-value="time">
                                                            {{time}}
                                                        </md-option>
                                                    </md-select>
                                                </md-input-container>                                                
                                            </md-list-item>
                                        </span>
                                    </span>                                 
                                </md-card-content>
                                <md-card-actions layout="row" layout-align="end center" flex>
                                    <md-button ng-click="closeCreateTask(); clearForm(createTaskForm)">Cancel</md-button>
                                    <md-button class="md-raised" ng-confirm-message="Are you sure you want to save this task?" ng-confirm-click="createTask(taskAddObj); closeCreateTask(); clearForm(createTaskForm)" ng-confirm-condition="true" style="background-color: {{primary_hue_normal.value}}; color: {{base_hue_lightest.value}};">Save</md-button>
                                </md-card-actions>
                            </form>
                        </md-card>
                        <md-card ng-show="taskAddObj.channels == 'In App Dialog'" class="md-card-base md-whiteframe-4dp" style="background-color: {{base_hue_lightest.value}}; position: relative;" flex flex-gt-sm="40">
                            <md-button ng-click="mediavault_filepicker(taskAddObj)" class="md-fab md-mini" aria-label="Edit Element Image" style="position: absolute; top: 16px; right: 16px; background-color: {{primary_hue_normal.value}}!important;">
                                <md-icon style="color: {{base_hue_lightest.value}}; cursor: pointer;" aria-label="change photo" md-font-library="material-icons">insert_photo</md-icon>
                            </md-button>
                            <img ng-value="'{{taskAddObj.source}}'" ng-src="{{ taskAddObj.source || 'https://storage.googleapis.com/mma-texas.appspot.com/media/images/missing-image-wide.png'}}" class="md-card-image">
                        </md-card>
                    </div>
                </div>
            </md-content>
        </md-card-content>
        <md-card-actions layout="row" layout-align="end center">
            <md-button disabled>Superpowered by Lightweight</md-button>
            <div flex></div>
            <md-button class="md-raised" ng-click="closeCreateTask(); clearForm(createTaskForm)" style="background-color: {{primary_hue_normal.value}}; color: {{base_hue_lightest.value}};">Close</md-button>
        </md-card-actions>
    </md-card>
</div>